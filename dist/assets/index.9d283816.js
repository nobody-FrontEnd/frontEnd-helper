import{d as ue,q as fe,r as c,H as pe,fl as he,y as B,aL as u,fm as de,fn as _e,fo as me,fp as Ue,c as x,w as r,u as f,o as C,a,E as H,dL as ve,aQ as ge,R as $,t as k,j as L,fq as ye,bq as we,fr as Se,cw as be,an as R,M as xe,fs as Ce,ft as $e,h as l,aR as ke,_ as Le}from"./index.fa3829f9.js";import{L as Ae}from"./layout3.7094ea6f.js";import{a as Pe}from"./browser.b44e01a3.js";const Ve={class:"shortUrls"},qe=["src","alt"],De={class:"shortUrls-item-container"},Be=ue({__name:"index",props:{clipboardValue:null,renderOnSearch:{type:Boolean}},emits:["acceptClipboardCb"],setup(O,{emit:F}){const z=O,{t:A}=fe(),p=c("fetching"),n=c({title:"",longUrl:"",shortUrlSuffix:""}),_=c(""),g=c([]),h=c("fetching");function G(e){W(e)}function N(){n.value.longUrl="",n.value.shortUrlSuffix="",n.value.title=""}pe(async()=>{var t;const e=(t=z.clipboardValue)==null?void 0:t.getOriginData();e&&he(e)&&(n.value.longUrl=e,F("acceptClipboardCb"));try{p.value="fetching",await M(),await w(),p.value="success"}catch{p.value="error"}await y()});async function W(e){try{await X(e.longUrl,{title:e.title}),N(),w(),await y()}catch(t){R.error("failed to create short URL"),console.error(t)}}async function E(e){try{await ee(e.key),await y()}catch(t){R.error("failed to delete short URL"),console.error(t)}}function I(e){e.deleteVisible=!1}async function y(){h.value="fetching";try{const e=await Y();g.value=[],g.value=await Promise.all(e.map(async t=>{const s=await Q(t.suffix),i=P(s);return{key:t.id,title:t.title?t.title:t.redirectUrl,suffix:t.suffix,redirectUrl:t.redirectUrl,shortUrl:s,shortUrlWithScheme:i,createdAt:new Date(t.createdAt).toDateString(),deleteVisible:!1,qrcodeUrl:await Pe(i)}})),h.value="success"}catch(e){h.value="error",console.error(e)}}async function M(){const{scheme:e,host:t}=await V();d.value=e,S.value=t}async function w(){const e=await K();n.value.shortUrlSuffix=e}async function T(e,t){if(t==="")throw A("shortUrl.emptyLongUrl");if(!/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/.test(t))throw A("shortUrl.wrongLongUrl")}const d=c(""),S=c("");B(()=>d.value,e=>{_.value=e+"://"+S.value+"/"}),B(()=>S.value,e=>{_.value=d.value+"://"+e+"/"});async function Z(e){e=P(e);try{await xe.openBrowser(e)}catch{console.error("failed")}}function P(e=""){return e.startsWith("http")||(d.value!==""?e=d.value+"://"+e:e="http://"+e),e}async function Q(e){return await V()+"/"+e}async function V(){const e=await j(),t=await J();return{scheme:e,host:t}}async function j(){return await u.get(de)}async function J(){return await u.get(_e)}async function K(){return await u.get(me)}async function X(e,t){return await u.post(Ce,{redirect_url:e,suffix:t==null?void 0:t.suffix,title:t==null?void 0:t.title})}async function Y(){return await u.get(Ue)}async function ee(e){return await u.delete($e.replace(":id",e.toString()))}return(e,t)=>{const s=l("a-alert"),i=l("a-input"),m=l("a-form-item"),b=l("a-col"),U=l("a-button"),te=l("a-row"),ae=l("a-input-group"),re=l("a-form"),q=l("a-spin"),oe=l("a-avatar"),D=l("a-popover"),le=l("a-typography-link"),ne=l("a-popconfirm"),se=l("a-list-item-meta"),ie=l("a-list-item"),ce=l("a-list");return C(),x(f(Ae),{"left-width":400,class:"layout"},{one:r(()=>[a(q,{spinning:p.value==="fetching"},{default:r(()=>[p.value==="error"?(C(),x(s,{key:0,type:"error",message:e.$t("shortUrl.initError")},null,8,["message"])):H("",!0),a(re,{model:n.value,layout:"vertical",onFinish:G},{default:r(()=>[a(m,{name:"longUrl",label:e.$t("shortUrl.longUrl"),rules:[{required:!0,validator:T,trigger:"blur"}]},{default:r(()=>[a(i,{value:n.value.longUrl,"onUpdate:value":t[0]||(t[0]=o=>n.value.longUrl=o),placeholder:"https://he3.app/"},null,8,["value"])]),_:1},8,["label","rules"]),a(m,{name:"shortUrlSuffix",label:e.$t("shortUrl.shortUrl"),rules:[{required:!1}]},{default:r(()=>[a(ae,null,{default:r(()=>[a(te,{gutter:5},{default:r(()=>[a(b,{span:12},{default:r(()=>[a(i,{value:_.value,"onUpdate:value":t[1]||(t[1]=o=>_.value=o),readonly:""},null,8,["value"])]),_:1}),a(b,{span:9},{default:r(()=>[a(i,{value:n.value.shortUrlSuffix,"onUpdate:value":t[2]||(t[2]=o=>n.value.shortUrlSuffix=o),readonly:""},null,8,["value"])]),_:1}),a(b,{span:3},{default:r(()=>[a(U,{shape:"circle",onClick:t[3]||(t[3]=o=>w())},{icon:r(()=>[a(f(ve))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["label"]),ge(a(m,{name:"title",label:e.$t("shortUrl.title"),rules:[{required:!1}]},{default:r(()=>[a(i,{value:n.value.title,"onUpdate:value":t[4]||(t[4]=o=>n.value.title=o)},null,8,["value"])]),_:1},8,["label"]),[[ke,!1]]),a(m,null,{default:r(()=>[a(U,{type:"primary","html-type":"submit"},{default:r(()=>[$(k(e.$t("shortUrl.submit")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])]),two:r(()=>[a(q,{spinning:h.value==="fetching"},{default:r(()=>[h.value==="error"?(C(),x(s,{key:0,type:"error",message:e.$t("shortUrl.getListError")},null,8,["message"])):H("",!0),L("div",Ve,[a(ce,{"data-source":g.value,"item-layout":"horizontal",class:"shortUrls-item"},{renderItem:r(({item:o})=>[a(ie,null,{default:r(()=>[a(se,null,{avatar:r(()=>[a(D,null,{content:r(()=>[L("img",{src:o.qrcodeUrl,alt:e.$t("shortUrl.qrcodeAlt")},null,8,qe)]),default:r(()=>[a(oe,null,{icon:r(()=>[a(f(ye))]),_:1})]),_:2},1024)]),title:r(()=>[L("div",De,[a(le,{class:"shortUrls-item-short",onClick:v=>Z(o.shortUrl)},{default:r(()=>[$(k(o.shortUrl),1)]),_:2},1032,["onClick"]),a(f(we),{class:"shortUrls-item-copy","copy-content":o.shortUrlWithScheme,icon:!0,title:" "},null,8,["copy-content"]),a(D,{visible:o.deleteVisible,"onUpdate:visible":v=>o.deleteVisible=v,trigger:"click",class:"shortUrls-item-more"},{content:r(()=>[a(ne,{title:e.$t("shortUrl.deletePopup"),"ok-text":e.$t("common.confirm"),"cancel-text":e.$t("common.cancel"),placement:"left",onConfirm:v=>E(o),onCancel:v=>I(o)},{default:r(()=>[a(U,{type:"primary",danger:""},{default:r(()=>[$(k(e.$t("shortUrl.delete")),1)]),_:1})]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])]),default:r(()=>[a(U,null,{icon:r(()=>[a(f(Se),{rotate:90})]),_:1})]),_:2},1032,["visible","onUpdate:visible"])])]),description:r(()=>[a(f(be),{"result-desc":"",result:o.redirectUrl,"show-copy-button":!1},null,8,["result"])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])])]),_:1},8,["spinning"])]),_:1})}}});const Fe=Le(Be,[["__scopeId","data-v-1f9ccf3b"]]);export{Fe as default};
